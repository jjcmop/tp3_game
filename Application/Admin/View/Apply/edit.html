<extend name="Public/base" />

<block name="body">
<link rel="stylesheet" type="text/css" href="__CSS__/admin_table.css" media="all">
<script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>

    <div class="main-title cf">
        <h2>编辑 [审核信息]</h2>
    </div>
    <!-- 标签页导航 -->
<div class="tab-wrap">
    <ul class="tab-nav nav">
        <li data-tab="tab1" class="current"><a href="javascript:void(0);">基础</a></li>
    </ul>
    <div class="tab-content zc_for">
    <!-- 表单 -->
    <form id="form" action="{:U('edit')}" method="post" class="form-horizontal">
        <!-- 基础文档模型 -->
        <div id="tab1" class="tab-pane in tab1 tab-look">
            <table  border="0" cellspacing="0" cellpadding="0">
                <tbody>
                  
                  <tr>
                    <td class="l">游戏名称：</td>
                    <td class="r" id='new_game'>
                        <input type="text" class="txt"  value="{:get_game_name($data['game_id'])}" disabled='disabled' />
                         <input type="hidden" name="dis_gameid" value="{$data['game_id']}"/>
                    </td>
                    <td class="l">申请人：</td>
                    <td class="r" id='new_person'>
                        <input type="text" class="txt" value="{:get_promote_name($data['promote_id'])}" disabled='disabled'/>
                        <input type="hidden" name="dis_promoteid" value="{$data['promote_id']}"/>
                    </td>
                  </tr>
                  <tr>
                    <td class="l">分成比例：</td>
                    <td class="r">
                        <input type="text" class="txt" name="ratio" value="{$data['ratio']}" placeholder="请输入1-100的数字,如:30即为30%">
                    </td>
                    <td class="l"></td>
                    <td class="r"></td>
                  </tr>
                  
                  <tr>
                    <td class="l">游戏状态：</td>
                    <td class="r">
                        <label class="inp_radio" id='new_status'>
                            <input type="radio" class="inp_radio" value="0" name="status" <eq name="data['status']" value="0">checked="checked"</eq>>未审核
                            <input type="radio" class="inp_radio" value="1" name="status" <eq name="data['status']" value="1">checked="checked"</eq>>通过
                            <input type="radio" class="inp_radio" value="2" name="status" <eq name="data['status']" value="2">checked="checked"</eq>>驳回
                        </label>
                    </td>
                    <td class="l">启用状态：</td>
                    <td class="r">
                        <label class="inp_radio">
                            <input type="radio" class="inp_radio" value="0" name="enable_status" <eq name="data['enable_status']" value="0">checked="checked"</eq>>关闭
                            <input type="radio" class="inp_radio" value="1" name="enable_status" <eq name="data['enable_status']" value="1">checked="checked"</eq>>启用
                        </label>
                    </td>
                  </tr>
                </tbody>
            </table>
        </div>

        <div class="form-item cf">
            <input type="hidden" name='id' value="{$data['id']}"></input>
            <button class="btn submit-btn ajax-post hidden" id="btn_sub" type="button" target-form="form-horizontal" >确 定</button>
            <a class="btn btn-return" href="javascript:history.back(-1);">返 回</a>
        </div>
    </form>
    </div>
</div>
</block>

<block name="script">
<script type="text/javascript">
//导航高亮
highlight_subnav('{:U('Apply/lists')}');
Think.setValue("game_type", {$data.game_type|default = 0});
Think.setValue("category", {$data.category|default = 0});

// $('#submit').click(function(){
//     $('#form').submit();
// });

$(function(){
	// $('.time').datetimepicker({
 //        format: 'yyyy-mm-dd hh:ii',
 //        language:"zh-CN",
 //        minView:2,
 //        autoclose:true
 //    });
 //    $('.date').datetimepicker({
 //        format: 'yyyy-mm-dd',
 //        language:"zh-CN",
 //        minView:2,
 //        autoclose:true
 //    });
    showTab();
});

// 2017-06-16新增js功能开始处
$(function(){
    function sub_from() {
        $('#form').submit();
    }
    function check() {
        var  new_status=$.trim($('#new_status').find('input[name=status]:checked ').val());
        if(new_status==1){
            $.ajax({
                url: "{:U('Apply/add_promote_game')}",
                //后台地址
                type: 'post',
                dataType: 'json',
                data: {               
                    'game_name':$.trim($("#new_game").find("input[type=text]").val()),
                    'game_id':"{$data['game_id']}",
                    'promote_account':$.trim($("#new_person").find("input[type=text]").val()),
                    'promote_id':"{$data['promote_id']}"
                },
                success:function(data){
                    // 根据返回的状态判断是否提交表单
                    if(data.status==1){
                        sub_from();
                    }else{
                        alert(data.msg);
                    }
                },
                error:function(){
                    alert("错误");
                }
            });
        }else{
           sub_from() ; 
        }
    }

$('#btn_sub').click(function(){
    check();
});

})
// 2017-06-16新增js功能结束处

</script>
</block>
